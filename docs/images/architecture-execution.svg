<svg xmlns="http://www.w3.org/2000/svg" width="1100" height="520" viewBox="0 0 1100 520" role="img" aria-label="Moltbot command execution and queueing flow">
  <defs>
    <linearGradient id="flow" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0" stop-color="#f6f5f3" />
      <stop offset="1" stop-color="#f0f6ff" />
    </linearGradient>
    <style>
      .frame { fill: url(#flow); stroke: #2b2b2b; stroke-width: 2; }
      .card { fill: #ffffff; stroke: #2b2b2b; stroke-width: 2; }
      .accent { fill: #e7f1ff; stroke: #2b2b2b; stroke-width: 2; }
      .queue { fill: #fff1d6; stroke: #2b2b2b; stroke-width: 2; }
      .storage { fill: #f1f7ed; stroke: #2b2b2b; stroke-width: 2; }
      .text { font: 15px "SF Pro Text", -apple-system, Helvetica, Arial, sans-serif; fill: #1a1a1a; }
      .title { font: 18px "SF Pro Display", -apple-system, Helvetica, Arial, sans-serif; font-weight: 600; fill: #1a1a1a; }
      .label { font: 12px "SF Pro Text", -apple-system, Helvetica, Arial, sans-serif; fill: #3c3c3c; }
      .arrow { stroke: #2b2b2b; stroke-width: 2; fill: none; marker-end: url(#arrow); }
    </style>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#2b2b2b" />
    </marker>
  </defs>

  <rect class="frame" x="30" y="30" width="1040" height="460" rx="18" />
  <text class="title" x="70" y="70">Execution flow: queue, agent run, tools, and storage</text>
  <text class="label" x="70" y="92">Session-lane queue keeps one active run per session</text>

  <rect class="card" x="70" y="140" width="220" height="120" rx="14" />
  <text class="text" x="180" y="175" text-anchor="middle">Inbound message</text>
  <text class="label" x="180" y="198" text-anchor="middle">DM 路 group 路 webchat</text>

  <rect class="queue" x="330" y="140" width="220" height="120" rx="14" />
  <text class="text" x="440" y="175" text-anchor="middle">Command queue</text>
  <text class="label" x="440" y="198" text-anchor="middle">session lanes + caps</text>
  <text class="label" x="440" y="218" text-anchor="middle">debounce + drop policy</text>

  <rect class="accent" x="590" y="120" width="220" height="160" rx="16" />
  <text class="text" x="700" y="165" text-anchor="middle">Agent run</text>
  <text class="label" x="700" y="188" text-anchor="middle">LLM calls + reasoning</text>
  <text class="label" x="700" y="210" text-anchor="middle">streaming events</text>

  <rect class="card" x="850" y="140" width="200" height="120" rx="14" />
  <text class="text" x="950" y="175" text-anchor="middle">Tool calls</text>
  <text class="label" x="950" y="198" text-anchor="middle">system.run 路 browser</text>

  <rect class="storage" x="330" y="320" width="320" height="120" rx="14" />
  <text class="text" x="490" y="355" text-anchor="middle">Session logs + memory</text>
  <text class="label" x="490" y="378" text-anchor="middle">jsonl transcripts 路 auth profiles</text>

  <rect class="storage" x="690" y="320" width="320" height="120" rx="14" />
  <text class="text" x="850" y="355" text-anchor="middle">Provider connections</text>
  <text class="label" x="850" y="378" text-anchor="middle">channels + model APIs</text>

  <line class="arrow" x1="290" y1="200" x2="330" y2="200" />
  <line class="arrow" x1="550" y1="200" x2="590" y2="200" />
  <line class="arrow" x1="810" y1="200" x2="850" y2="200" />
  <line class="arrow" x1="700" y1="280" x2="700" y2="320" />
  <line class="arrow" x1="590" y1="220" x2="490" y2="320" />
  <line class="arrow" x1="810" y1="220" x2="850" y2="320" />
</svg>
